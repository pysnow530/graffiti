# Canvas 涂鸦板

一个基于HTML5 Canvas的简单涂鸦应用，支持自由绘画和基本的画笔控制功能。

## 功能特性

- 🎨 **自由绘画** - 使用鼠标或触摸屏进行绘画
- 🌈 **颜色选择** - 支持任意颜色选择
- 📏 **画笔大小** - 可调节画笔粗细（1-50px）
- 📷 **图片导入** - 支持导入本地图片进行编辑和涂鸦
- 🔍 **图像描边** - 多角度全覆盖边缘检测，用蓝点标记图像轮廓
- ⚙️ **扫描精度** - 可调节角度扫描间隔（1-20度）
- 🧹 **清空画布** - 一键清空所有内容
- 💾 **保存图片** - 将作品保存为PNG格式
- 📱 **移动端支持** - 支持触摸设备使用
- 🎯 **响应式设计** - 适配不同屏幕尺寸

## 如何使用

1. **开始绘画**
   - 在画布上按住鼠标左键并拖动即可开始绘画
   - 移动设备上可以用手指触摸绘画

2. **调整画笔**
   - 点击颜色选择器更换画笔颜色
   - 拖动滑块调整画笔大小

3. **导入图片**
   - 点击"导入图片"按钮选择本地图片文件
   - 支持常见图片格式（JPG、PNG、GIF等）
   - 图片会自动适应画布尺寸，保持原始比例
   - 导入后可以在图片上进行涂鸦和描边

4. **图像描边**
   - 调整"扫描精度"滑块设置角度间隔（数值越小，扫描越密集）
   - 点击"图像描边"按钮对当前画布内容进行多角度全覆盖边缘检测
   - 系统使用宽度为5个点的扫描带代替单线扫描，提供高效的边缘检测鲁棒性
   - 用蓝色圆点标记出图像的外轮廓边缘

5. **管理作品**
   - 点击"清空画布"按钮清除所有内容
   - 点击"保存图片"按钮下载PNG格式的作品

## 项目结构

```
graffiti/
├── index.html              # 主页面
├── style.css               # 样式文件
├── js/                     # JavaScript模块目录
│   ├── utils.js            # 通用工具函数
│   ├── drawing-engine.js   # 画布绘图引擎
│   ├── image-processor.js  # 图像处理器
│   ├── edge-detection.js   # 边缘检测算法
│   └── graffiti-app.js     # 主应用控制器
├── script.js.backup        # 原始单文件备份
└── README.md               # 说明文档
```

## 模块化架构

### 🎨 DrawingEngine (绘图引擎)
- **职责**: 画笔绘制、画布初始化和基本操作
- **功能**: 
  - 画笔绘制 (startDrawing, draw, stopDrawing)
  - 画布操作 (initCanvas, clearCanvas, saveCanvas)
  - 鼠标/触摸事件处理
  - 画笔设置 (颜色、大小)

### 📷 ImageProcessor (图像处理器)
- **职责**: 图片导入、处理和在画布上绘制
- **功能**:
  - 图片上传和验证
  - 图片缩放和绘制到画布
  - 像素数据获取和分析
  - 点集绘制功能

### 🔍 EdgeDetectionAlgorithm (边缘检测算法)
- **职责**: 图像边缘检测和相关算法实现
- **功能**:
  - 多角度全覆盖扫描算法
  - 圆形区域像素检测
  - 性能统计和监控
  - 边缘点提取和优化
- **数据格式**: 返回结构化点对象数组 `[{x: number, y: number}, ...]`

### 🎛️ GraffitiApp (主应用控制器)
- **职责**: 整体协调、UI交互和通知系统
- **功能**:
  - 模块间协调和通信
  - UI事件绑定和处理
  - 通知系统管理
  - 应用生命周期管理

### 🛠️ Utils (工具函数)
- **职责**: 通用辅助功能
- **功能**:
  - 数学计算函数
  - 格式化工具
  - 防抖节流函数
  - 深拷贝等通用方法

## 技术实现

- **HTML5 Canvas** - 绘图功能的核心
- **JavaScript ES6+** - 模块化类组织，职责分离
- **File API & FileReader** - 本地图片文件读取和处理
- **Image对象处理** - 图片缩放、适配和绘制
- **多角度边缘检测算法** - 基于5点宽扫描带的轻量级鲁棒性描边功能
- **Canvas ImageData API** - 像素级图像数据处理
- **CSS3** - 现代化的界面设计和通知系统
- **响应式布局** - 适配多种设备
- **结构化数据** - 边缘检测返回标准化的点对象数组

## 运行方法

1. 直接在浏览器中打开 `index.html` 文件即可使用
2. 或者使用本地服务器：
   ```bash
   # 使用Python简单服务器
   python -m http.server 8000
   
   # 使用Node.js服务器
   npx serve .
   ```

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 开发说明

项目采用模块化架构，代码结构清晰，职责分离，易于维护和扩展。每个模块都有明确的职责和接口，可以独立开发和测试。

### 🔧 模块扩展指南

- **DrawingEngine**: 添加新的画笔样式、几何图形绘制工具
- **ImageProcessor**: 实现图像滤镜、特效处理功能
- **EdgeDetectionAlgorithm**: 集成高级边缘检测算法（Canny、Sobel等）
- **GraffitiApp**: 添加新的UI功能、键盘快捷键、撤销/重做
- **Utils**: 扩展数学工具、性能监控、调试辅助功能

### 💡 建议的功能扩展

- 不同的画笔样式和纹理
- 几何图形绘制工具
- 高级边缘检测算法（Canny、Sobel等）
- 图像滤镜和特效
- 图层功能和混合模式
- 撤销/重做功能
- 矢量图形支持
- 实时协作功能

### 📊 API数据格式

**边缘检测结果格式**：
```javascript
// 新格式：结构化点对象数组（推荐）
const edgePoints = [
    {x: 100, y: 50},
    {x: 105, y: 52},
    {x: 110, y: 48}
];

// 转换为其他格式
const stringFormat = edgeDetector.convertEdgePointsFormat(edgePoints, 'string');
// 结果: ["100,50", "105,52", "110,48"]

const arrayFormat = edgeDetector.convertEdgePointsFormat(edgePoints, 'array');
// 结果: [[100,50], [105,52], [110,48]]
```

**优势**：
- ✅ 类型安全，便于IDE提示和错误检查
- ✅ 更直观的数据结构，易于理解和使用
- ✅ 支持扩展（可添加更多属性如颜色、权重等）
- ✅ 向后兼容，`drawPoints`方法仍支持字符串格式

## 边缘检测算法优势

**5点扫描带 vs 单线扫描**：
- ✅ **良好容错性**：±2像素的容错范围，能够处理大部分位置偏差
- ✅ **稳定覆盖率**：有效检测常规线条和一般间隙情况  
- ✅ **基础稳定性**：抵抗基本的噪点和图片质量问题
- ✅ **广泛适应性**：对常见的手绘线条和图片边缘检测效果良好
- ✅ **轻量高效**：算法简洁，运行速度快，资源占用少
- ✅ **实用性强**：满足大部分日常涂鸦和图像处理需求

### 🚀 算法进化历程

| 版本 | 检测方式 | 容错范围 | 适用场景 | 可靠性 |
|------|----------|----------|----------|--------|
| 1.0 | 单线扫描 | 0像素 | 理想线条 | ⭐⭐ |
| **2.0** | **5点扫描带** | **±2像素** | **日常使用** | **⭐⭐⭐** |

### 🎯 5点扫描带结构示意
```
扫描方向 →
    ●    ← 点-2
    ●    ← 点-1
    ●    ← 中心（记录位置）
    ●    ← 点+1
    ●    ← 点+2
         ← 容错范围：±2像素
```

---

**Made with ❤️ 享受创作的乐趣！** 